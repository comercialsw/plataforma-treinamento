<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartWay | Login</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="login-container">
    <img src="logo-smartway.jpg" alt="Logo SmartWay" class="logo" />
    <h2>Acesso à Plataforma</h2>

    <input id="email"    type="email"    placeholder="E-mail" required />
    <input id="password" type="password" placeholder="Senha" required />

    <button id="btnLogin">Entrar</button>
    <button id="btnRegister" class="outline">Primeiro acesso</button>
    <p id="error" class="error"></p>
  </div>

  <script type="module">
    /* 1) IMPORTS – SDK 11.27.0 ----------------------------------- */
    import { initializeApp }               from 'https://www.gstatic.com/firebasejs/11.27.0/firebase-app.js';
    import { getAuth,
             setPersistence,
             browserLocalPersistence,
             signInWithEmailAndPassword,
             createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/11.27.0/firebase-auth.js';
    import { initializeFirestore,
             doc, setDoc }                 from 'https://www.gstatic.com/firebasejs/11.27.0/firebase-firestore.js';

    /* 2) CONFIGURAÇÃO (substitua pelos seus valores) ------------- */
    const firebaseConfig = {
      apiKey:            'SUA_API_KEY',
      authDomain:        'SEU_PROJETO.firebaseapp.com',
      projectId:         'SEU_PROJETO',
      storageBucket:     'SEU_PROJETO.appspot.com',
      messagingSenderId: 'SEU_SENDER_ID',
      appId:             'SEU_APP_ID',
      databaseURL:       'https://SEU_PROJETO-default-rtdb.firebaseio.com'
    };

    /* 3) INICIALIZAÇÃO ------------------------------------------ */
    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = initializeFirestore(app, { experimentalForceLongPolling: true });

    /* 4) Persistência local -------------------------------------- */
    setPersistence(auth, browserLocalPersistence).catch(console.error);

    /* 5) Elementos ------------------------------------------------ */
    const emailEl   = document.getElementById('email');
    const passEl    = document.getElementById('password');
    const btnLogin  = document.getElementById('btnLogin');
    const btnReg    = document.getElementById('btnRegister');
    const errorEl   = document.getElementById('error');

    /* 6) Login ---------------------------------------------------- */
    btnLogin.addEventListener('click', async () => {
      errorEl.textContent = '';
      try {
        await signInWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value);
        window.location.href = 'dashboard.html';
      } catch (e) {
        errorEl.textContent = 'Usuário ou senha inválidos.';
        console.error(e);
      }
    });

    /* 7) Registro ------------------------------------------------- */
    btnReg.addEventListener('click', async () => {
      errorEl.textContent = '';
      const email = emailEl.value.trim();
      const pwd   = passEl.value;
      if (!email || !pwd) { errorEl.textContent = 'Preencha e-mail e senha.'; return; }

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pwd);
        await setDoc(doc(db, 'progresso', cred.user.uid), {
          email,
          assistidos: [],
          categorias_concluidas: [],
          certificado_emitido: false
        });
        window.location.href = 'dashboard.html';
      } catch (e) {
        errorEl.textContent = 'Erro no cadastro: ' + e.message;
        console.error(e);
      }
    });
  </script>
</body>
</html>
